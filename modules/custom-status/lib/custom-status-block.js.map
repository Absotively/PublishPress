{"version":3,"sources":["custom-status-block.jsx"],"names":[],"mappings":"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","file":"custom-status-block.js","sourcesContent":["/**\n * ------------------------------------------------------------------------------\n * Based on Edit Flow\n * Author: Daniel Bachhuber, Scott Bressler, Mohammad Jangda, Automattic, and\n * others\n * Copyright (c) 2009-2019 Mohammad Jangda, Daniel Bachhuber, et al.\n * ------------------------------------------------------------------------------\n */\n\nlet {__} = wp.i18n;\nlet {PluginPostStatusInfo} = wp.editPost;\nlet {registerPlugin} = wp.plugins;\nlet {withSelect, withDispatch} = wp.data;\nlet {compose} = wp.compose;\nlet {SelectControl} = wp.components;\n\n/**\n * Map Custom Statuses as options for SelectControl\n */\nlet statuses = window.PPCustomStatuses.map(s => ({label: s.name, value: s.slug}));\nlet getStatusLabel = slug => {\n    let item = statuses.find(s => s.value === slug);\n\n    if (label) {\n        return item.label;\n    }\n\n    return '';\n};\n\n// Remove the Published status from the list.\nstatuses = statuses.filter((item) => {\n    return item.value !== 'publish';\n});\n\n/**\n * Hack :(\n *\n * @see https://github.com/WordPress/gutenberg/issues/3144\n *\n * @param status\n */\nlet sideEffectL10nManipulation = status => {\n\n    if (status === 'publish') {\n        return;\n    }\n\n    let statusLabel = getStatusLabel(status);\n\n    setTimeout(() => {\n        let node = document.querySelector('.editor-post-save-draft');\n\n        if (!node) {\n            node = document.querySelector('.editor-post-switch-to-draft');\n        }\n\n        if (node) {\n            document.querySelector('.editor-post-save-draft, .editor-post-switch-to-draft').innerText = `${__('Save as')} ${statusLabel}`;\n            node.dataset.ppInnerTextUpdated = true;\n        }\n    }, 100);\n};\n\n/**\n * Hack :(\n * We need an interval because the DOM element is removed by autosave and rendered back after finishing.\n *\n * @see https://github.com/WordPress/gutenberg/issues/3144\n */\nsetInterval(() => {\n    let status = wp.data.select('core/editor').getEditedPostAttribute('status');\n\n    if (status === 'publish') {\n        return;\n    }\n\n    let statusLabel = getStatusLabel(status);\n    let node = document.querySelector('.editor-post-save-draft');\n\n    if (!node) {\n        node = document.querySelector('.editor-post-switch-to-draft');\n    }\n\n    if (node && !node.dataset.ppInnerTextUpdated) {\n        document.querySelector('.editor-post-save-draft, .editor-post-switch-to-draft').innerText = `${__('Save as')} ${statusLabel}`;\n        node.dataset.ppInnerTextUpdated = true;\n    }\n}, 250);\n\n/**\n * Custom status component\n * @param object props\n */\nlet PPCustomPostStatusInfo = ({onUpdate, status}) => (\n    <PluginPostStatusInfo\n        className={`publishpress-extended-post-status publishpress-extended-post-status-${status}`}\n    >\n        <h4>{__('Post Status', 'publishpress')}</h4>\n\n        {status !== 'publish' ? <SelectControl\n            label=\"\"\n            value={status}\n            options={statuses}\n            onChange={onUpdate}\n        /> : <div>{__('Published', 'publishpress')}</div>}\n\n        <small className=\"publishpress-extended-post-status-note\">\n            {status !== 'publish' ? __(`Note: this will override all status settings above.`, 'publishpress') : __('To select a custom status, please unpublish the content first.', 'publishpress')}\n        </small>\n    </PluginPostStatusInfo>\n);\n\nlet plugin = compose(\n    withSelect((select) => ({\n        status: select('core/editor').getEditedPostAttribute('status')\n    })),\n    withDispatch((dispatch) => ({\n        onUpdate (status) {\n            dispatch('core/editor').editPost({status});\n            sideEffectL10nManipulation(status);\n        }\n    }))\n)(PPCustomPostStatusInfo);\n\nregisterPlugin('publishpress-custom-status-block', {\n    icon: 'admin-site',\n    render: plugin\n});\n"]}